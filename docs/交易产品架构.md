根据交易流程的链路图，我们将产品域分为了：商品域、交易域、支付域、账户域。  
根据每个域的功能和支持的业务不同，我们进行如下的细化，最终明确交易产品需要哪些模块来组成。

![avatar](../images/交易产品架构.png ':size=800')

一、购物车  

购物订单：  

?> 客户加入的订单，包括订单信息、数量、价格。  

收货地址：  

?> 维护客户的收货信息，包括收件人、手机号、地址。  

交易方式：  

?> 包括匿名支付、他人代付、货到付款、线上支付、现金支付、信用支付等。  

优惠券：  

?> 红包和优惠券、积分。  

二、收银台 

支付单：  

?> 购物车确认之后提交的订单，显示商品明细和支付金额。类似超市的购物小票。  

支付路由：  

?> 1、根据交易方式，选择性展示支付渠道，例如现金支付，只展示储蓄卡的支付渠道。  
2、根据选择的支付渠道，后台自动选择成功率高的支付子渠道。例如通过支付宝支付，可以选择支付宝官方渠道，也可以选择走其他代理的第三方支付渠道。  

支付渠道：  

?> 在收银台中展示支付方式，例如支付宝、微信、银联等等。  

三：支付结算  

1、交易流水  

?> 支付完成后，存放交易流水账单。  

2、会计凭证  

?> 根据交易流水账单，生成会计分录，并记录会计凭证表。  

3、日终对账  

?> 与支付渠道进行交易流水的对账。  

4、退款交易  

?> 发起订单退款，找到原支付单，进行支付单的撤销和资金的原路退回。  

四：电子钱包  
很多电商平台，会收购支付牌照或选择与银行合作，搭建自身的钱包账户体系，例如：京东钱包、拼多多的拼付宝，主要目的还是为了账户中沉淀的资金。  

1、交易逻辑  

?> 处理钱包体系内的交易流程。  

2、支付结算  

?> 1、负责发起对资金存管银行的支付指令。  
2、负责记录交易流水账单。  

3、会计凭证  

?> 根据交易流水账单，生成会计分录，并记录会计凭证表。  

4、清算对账  

?> 与资金存管银行的交易流水对账。  

5、电子账户  

?> 平台体系内的结算账户，与资金存管银行的账户是1:1关系。  