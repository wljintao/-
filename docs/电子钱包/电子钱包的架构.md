#### 一、背景
目前国内很多电商平台，在发展自身主业时，为了兼顾交易支付的在线化和资金的安全性，便“自告奋勇”的提出了平台担保业务，其实本质就是买家的资金打给了平台，平台告诉卖家发货，卖家发货签收之后过7-14天，平台把钱打给卖家。

这件事情，看起来很美好，但交易风险便集中在了平台本身，若平台发生信用风险或者经营风险，则势必会造成买卖双方的资产损失；同时从交易的本身来看，平台也涉及了“二清”（请自行百度“二清”的定义）的问题。

为了规避这个问题，平台会选择去收购一家支付牌照（例如有赞、拼多多），将平台的资金托管至支付机构中，受监管机构的监管。but 一张支付牌照的价格至少2亿起。有多少老板卖了底裤都不够。

还有一条路，就是与银行合作，将资金存管至银行的账户中。借用银行的账户体系，在平台上架设电子钱包服务，用户平台内使用钱包进行支付，实际变成了银行账户之间的冻结和转账交易。

#### 二、电子钱包
##### 2.1 钱包架构

一般来说，电子钱包的典型架构会包含如下模块：

![avatar](../../images/电子钱包架构.png ':size=700')

从架构上来说，分为三层：

**业务层：** 用来支持平台内涉及资金交易和存放的业务产品，例如充值卡、支付货款、退款、理财基金等业务。

**服务层：** 提供产品的功能接口，包括实名认证、充值接口、提现接口、支付接口等，由业务层对按照各自业务流程进行对接组装。

**产品层：** 钱包的底层功能模块，包括账户开户、资金存取、流水对账等功能。

##### 2.2 钱包的主要功能模块

先来看一下钱包的业务流程：

![avatar](../../images/钱包业务流程.png ':size=700')

**交易：** 接受支付请求，进行风控校验拦截，通过风控后根据订单类型判断交易方式（可以信用卡还是不能信用卡）。

**收银台： 这里的收银台是指钱包的收银台，**根据交易传递的交易方式，配置可用的支付渠道，并进行展示。大部分银行的电子账户是可以支持支付宝、微信进行充值的。

**支付结算：** 生成支付单、提供退款功能。

**会计凭证：** 根据支付单流水，进行会计分录的记账，记账的科目参考财务报表。

**清算对账：** 支付单与支付渠道交易明细的自动核对（通常T+1），确保交易数据的准确性和一致性。

**电子账户：** 平台用户的虚拟账户，以及平台的自身虚拟账户。


##### 2.3 钱包的管理平台

管理平台为钱包系统提供了运维支持平台，主要包括如下：

**运维监控：** 支付系统在下运行过程中不可避免的会受到各种内部和外部的干扰，光纤被挖断、黑客攻击、数据库被误删、上线系统中有bug等等，运维人员必须在第一时间内对这些意外事件作出响应，又不能够一天24小时盯着。这就需要一个运维监控系统来协助完成。

**日志分析：** 日志是支付系统统计分析、运维监控的重要依据。公司需要提供基础设施来支持日志统一收集和分析。

**短信平台：** 短信在支付系统中有重要作用： 身份验证、安全登录、找回密码、以及报警监控，都需要短信的支持。

**安全机制：** 安全是支付的生命线。 SSL、证书系统、防刷接口等，都是支付的必要设施。

**统计报表：** 支付数据的可视化展示，是公司进行决策的基础。



